{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/marielaramoncorria/notebook0cf95c4ffd?scriptVersionId=287361670\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"markdown","id":"1465ec03","metadata":{"papermill":{"duration":0.002103,"end_time":"2025-12-20T01:01:00.992113","exception":false,"start_time":"2025-12-20T01:01:00.99001","status":"completed"},"tags":[]},"source":["<h3 style=\"color: #FF6347; font-size: 1.5em; font-weight: bold; margin-top: 0px; margin-bottom: 20px;\">4.1 Data Structure Design and Aggregations</h3>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">Data organization was strategically achieved by consolidating cleaned, granular files into two distinct analytical structures: the <strong>Hourly Trend Table</strong> and the <strong>User Summary Table</strong>. This approach ensured that all key metrics were aggregated by the appropriate dimension (<strong>Hour</strong> for trends, <strong>Id</strong> for segmentation).</p>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 15px;\">A. Master Table Consolidation (Hourly Granularity)</h4>\n","<p style=\"font-size: 1.15em; text-align: justify;\">The <strong>hourly_master_final</strong> structure was created by performing <strong>Full Outer Joins</strong> across all cleaned, hourly datasets. The merge utilized composite keys (<strong>Id</strong>, <strong>Date</strong>, and <strong>Hour</strong>) to aggregate metrics at an <strong>hourly level</strong>, serving as the primary source for trend analysis.</p>\n","<table style=\"border-collapse: collapse; width: 100%; margin-top: 15px; margin-bottom: 20px; table-layout: fixed;\">\n","<tr style=\"background-color: #f2f2f2;\">\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left; width: 30%;\">Aggregated Structure</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left; width: 30%;\">Purpose</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left; width: 40%;\">Key Metrics</th>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><strong>User Summary Table</strong></td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Profiles the consumer by normalizing usage across time using <strong>AVG</strong> functions.</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><em>Id, Days_Tracked, Avg_MinutesAsleep, Avg_TotalSteps, Avg_TotalCalories, SleepQuality</em></td>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><strong>Hourly Trend Table</strong></td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Aggregates metrics by <strong>Hour of Day</strong> across all users to identify time-based patterns.</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><em>Hour, Hours_Tracked, Avg_Calories, Total_MinutesAsleep, Avg_TotalSteps, Avg_AvgMETs</em></td>\n","</tr></table>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 15px;\">B. Calculated Fields and Normalization</h4>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">To establish accurate metrics, the <strong>Avg_MinutesAsleep</strong> was normalized against the number of days tracked. The <strong>SleepQuality</strong> field was then engineered based on public health guidelines (7–9 hours):</p>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px; margin-bottom: 20px;\">\n","<li style=\"margin-bottom: 10px;\"><strong>Normalization Logic:</strong> Total minutes asleep for each unique ID divided by <strong>Days_Tracked</strong> via VLOOKUP from a Pivot Helper Table.</li><br>\n","<li style=\"margin-bottom: 10px;\"><strong>Low_Sleep:</strong> Less than 420 min (Below the recommended 7-hour threshold).</li>\n","<li style=\"margin-bottom: 10px;\"><strong>Optimal_Sleep:</strong> 420 to 540 min (The recommended 7 to 9 hours for recovery).</li>\n","<li style=\"margin-bottom: 10px;\"><strong>High_Sleep:</strong> More than 540 min (Above-average priority for sleep).</li></ul>\n","<hr style=\"border: 0.5px solid #dcdcdc; margin-top: 30px; margin-bottom: 0px;\">\n","<h3 style=\"color: #FF6347; font-size: 1.5em; font-weight: bold; margin-bottom: 20px;\">4.2 Data Format Verification</h3>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">The data was properly formatted, but it <strong>required significant transformation</strong> during the cleaning and merging process to ensure analytical integrity:</p>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px; margin-bottom: 20px;\">\n","<li style=\"margin-bottom: 15px;\"><strong>Date/Time Transformation:</strong> The <strong>ActivityDate</strong> field was converted from text/string format to proper <strong>Date</strong> and <strong>DateTime</strong> objects. New columns, such as <strong>Hour</strong> and <strong>Day_of_Week</strong>, were extracted to support time-series analysis.</li>\n","<br>\n","<li style=\"margin-bottom: 15px;\"><strong>Data Type Consistency:</strong> The <strong>Id</strong> column was maintained as a consistent data type across all merged tables to prevent join errors.</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Data Quality Validation:</strong> After the merging process, the data was re-verified, confirming persistent incidents of quality issues such as <strong>zero HeartRate</strong> or <strong>zero steps</strong>, which required subsequent exclusion.</li></ul>\n","<h3 style=\"color: #FF6347; font-size: 1.5em; font-weight: bold; margin-top: 40px; margin-bottom: 20px;\">4.3 EDA Analysis and Calculations</h3>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-bottom: 15px;\">A. Summary Statistics and Data Trend Validation</h4>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\"><strong>Mean, Median, and Standard Deviation ($\\sigma$)</strong> were generated for key metrics to confirm the dominant underlying trends and stability issues within the data:</p>\n","<table style=\"width: 100%; border-collapse: collapse; margin-top: 15px; margin-bottom: 30px;\">\n","<tr style=\"background-color: #f2f2f2;\">\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left;\">Statistic</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left;\">Avg_Calories</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left;\">Avg_MinutesAsleep</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left;\">Avg_SedentaryMinutes</th>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Mean</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">2184.64</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">409.15</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">995.00</td>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Median</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">2089.21</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">159.59</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">1084.20</td>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Std Dev ($\\sigma$)</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">584.57</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">443.26</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">234.66</td>\n","</tr></table>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 15px;\">B. Data Validation: Pearson Correlation Coefficients</h4>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">Crucially, <strong>Pearson Correlation Coefficients</strong> were calculated to validate the internal reliability of the device's sensor data:</p>\n","<table style=\"width: 100%; border-collapse: collapse; margin-top: 15px; margin-bottom: 20px;\">\n","<tr style=\"background-color: #f2f2f2;\">\n","<th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Correlated Metrics</th>\n","<th style=\"border: 1px solid #ddd; padding: 12px; text-align: left;\">Value</th>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Avg. METs vs. Avg. Heart Rate</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">0.978535839</td>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Avg. Steps vs. Avg. Heart Rate</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">0.979900356</td>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Avg. Steps vs. Calories</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">0.992815335</td>\n","</tr></table>\n","<p style=\"font-size: 1.15em; text-align: justify;\">These high correlation values confirm the <strong>reliability and internal consistency</strong> of the device's physiological sensors.</p>\n","<h3 style=\"color: #FF6347; font-size: 1.5em; font-weight: bold; margin-bottom: 25px;\">4.4 Trends and Relationships: Structural & Behavioral Patterns</h3>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 30px;\">The following findings validate the urgency for a strategy centered on <strong>Recovery</strong> and <strong>Consistency</strong>, while also revealing unexpected structural flaws that impact data quality and user retention:</p>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 20px;\">A. Core Problem: Inconsistency and Habit Failure</h4>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px;\">\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 1: The Critical Churn Window.</strong> The most vital finding is the pervasive inconsistency in user habits, resulting in a <strong>71% drop-off</strong> clustered in the hyper-sensitive <strong>8-12 Day window</strong>. This confirms that the primary business challenge is user retention driven by habit failure.<div style=\"background-color: #fdf2f0; border-left: 5px solid #FF6347; padding: 15px; margin-top: 15px; margin-bottom: 15px;\"><strong>Supporting Evidence: The Data Quality Crisis.</strong> Surprisingly, a critical cleaning step revealed that <strong>over 11,000 hourly records</strong> (approximately <strong>47%</strong> of all hourly activity entries) had <strong>0</strong> values. This massive volume confirms that <strong>inconsistent device wear or synchronization failure is the dominant pattern</strong>.</div></li>\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 2: Structural Barrier: BMR Dominance Disrupts Motivation.</strong> Analysis confirmed the <strong>Average Calories Burned</strong> is remarkably stable and clustered. This stability is due to the <strong>Basal Metabolic Rate (BMR)</strong> dominating the calculation, meaning daily calories burned persist even if the device is not worn. This finding confirms that the <strong>Total Calories</strong> metric is a <strong>poor motivational tool</strong> for users.</li></ul>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 20px;\">B. The Recovery Crisis: Sleep Deficit and Dependence</h4>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px;\">\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 3: The 91% Sleep Deficit.</strong> Unexpectedly, only <strong>9%</strong> of the users achieved the recommended Optimal Sleep (7–9 hours). This vast <strong>91% deficit</strong> confirms that <strong>Recovery is the largest untapped market</strong> for Bellabeat.</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 4: Recovery Drives Activity.</strong> The <strong>High_Sleep</strong> segment accounts for the overwhelming <strong>majority (89%)</strong> of total Very_Active_Minutes. This proves a <strong>direct dependence</strong>: <strong>recovery drives device usage</strong> and the ability to perform high-intensity workouts.</li></ul>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 20px;\">C. Weekly Behavior: Inactivity Peaks and Engagement Gaps</h4>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px;\">\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 5: Engagement Gap.</strong> <strong>Tuesday</strong> is the <strong>weakest day for all activity</strong> (157 min), suggesting a significant engagement gap early in the week.</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 6: Work-Driven Inactivity.</strong> Sedentary Time peaks on <strong>Thursday and Friday</strong> (over 1054 min), suggesting inactivity is <strong>forced by work/commuting hours</strong>, not leisure.</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Key Finding 7: Strategic Activity Peaks.</strong> Total Active Minutes are maximal on <strong>Wednesday and Saturday</strong> (221.6 min each), making them optimal windows for marketing intervention.</li></ul>\n","<h3 style=\"color: #FF6347; font-size: 1.5em; font-weight: bold; margin-top: 50px; margin-bottom: 20px;\">4.5 How Will These Insights Help Answer Your Business Questions?</h3>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">The insights derived from the analysis enable micro-segmentation and direct product strategy:</p>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px;\">\n","<li style=\"margin-bottom: 15px;\"><strong>Problem Definition:</strong> The analysis confirmed that the primary business challenge is <strong>retention</strong> and <strong>habit formation</strong>, not technical failure, by quantifying the massive <strong>71% drop-off</strong> in the <strong>8-12 day window</strong>.</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Target Market Validation:</strong> The findings validate the clear target market for Bellabeat's sleep-focused features (like the <strong>Leaf</strong>) by identifying the widespread <strong>91% sleep deficit</strong> and the <strong>direct link</strong> between sleep commitment and high-intensity activity (89% dependency).</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Metric Correction & Value Proposition:</strong> The finding that the <strong>Total Calories</strong> metric is dominated by BMR confirms the need for an immediate shift away from <strong>\"Activity Volume\"</strong> to <strong>\"Effort & Readiness\"</strong> to better motivate user behavior change.</li>\n","<li style=\"margin-bottom: 15px;\"><strong>Micro-Segmentation & Timing:</strong> The analysis of <strong>weekly and hourly trends</strong> (Tuesday gap, Thursday/Friday peaks, 7 PM peak) enables the precise segmentation of <strong>behavioral pain points</strong> and identifies the <strong>optimal time windows</strong> to influence habit formation.</li></ul>\n","<hr style=\"border: 0.5px solid #dcdcdc; margin-top: 30px; margin-bottom: 0px;\">\n","<hr style=\"border: 0.5px solid #dcdcdc; margin-top: 30px; margin-bottom: 0px;\">"]},{"cell_type":"markdown","id":"c8d23538","metadata":{"papermill":{"duration":0.00132,"end_time":"2025-12-20T01:01:00.994965","exception":false,"start_time":"2025-12-20T01:01:00.993645","status":"completed"},"tags":[]},"source":["<h3 style=\"color: #FF6347; font-size: 1.5em; font-weight: bold; margin-top: 0px; margin-bottom: 20px;\">4.1 Data Structure Design and Aggregations</h3>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">Data organization was strategically achieved by consolidating cleaned, granular files into two distinct analytical structures: the <strong>Hourly Trend Table</strong> and the <strong>User Summary Table</strong>. This approach ensured that all key metrics were aggregated by the appropriate dimension (<strong>Hour</strong> for trends, <strong>Id</strong> for segmentation).</p>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 15px;\">A. Master Table Consolidation (Hourly Granularity)</h4>\n","<p style=\"font-size: 1.15em; text-align: justify;\">The <strong>hourly_master_final</strong> structure was created by performing <strong>Full Outer Joins (Merge Queries)</strong> across all cleaned, hourly datasets (Intensity, Steps, Calories, HeartRate, METs, and Sleep summaries). The merge utilized the three composite keys (<strong>Id</strong>, <strong>Date</strong>, and <strong>Hour</strong>) to aggregate all metrics at an <strong>hourly level</strong>. This table is the source for trend analysis and variance calculation.</p>\n","<table style=\"border-collapse: collapse; width: 100%; margin-top: 15px; margin-bottom: 20px; table-layout: fixed;\">\n","<tr style=\"background-color: #f2f2f2;\">\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left; width: 30%;\">Aggregated Structure</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left; width: 30%;\">Purpose</th>\n","<th style=\"border: 1px solid #ddd; padding: 10px; text-align: left; width: 40%;\">Key Metrics</th>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><strong>User Summary Table (Segmentation)</strong></td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Profiles the consumer by normalizing usage across time using <strong>AVG</strong> functions.</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><em>Id, Days_Tracked, Avg_MinutesAsleep, Avg_SedentaryMinutes, Avg_TotalSteps, Avg_TotalCalories, Avg_VeryActiveMinutes, SleepQuality</em></td>\n","</tr>\n","<tr>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><strong>Hourly Trend Table</strong></td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\">Aggregates all metrics by <strong>Hour of Day</strong> across all users to identify time-based patterns.</td>\n","<td style=\"border: 1px solid #ddd; padding: 10px;\"><em>Hour, Hours_Tracked, Avg_Calories, Total_MinutesAsleep, Avg_AvgIntensity, Avg_TotalSteps, Avg_AvgMETs, Avg_AvgHeartRate, StdDev_AvgIntensity</em></td>\n","</tr></table>\n","<h4 style=\"color: #FF6347; font-size: 1.25em; font-weight: bold; margin-top: 40px; margin-bottom: 15px;\">B. Calculated Fields</h4>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-bottom: 20px;\">To establish accurate average metrics for key user behaviors, the <strong>Avg_MinutesAsleep</strong> metric was calculated by normalizing the total recorded sleep time against the number of days tracked by each user, as the raw data was not consistently tracked daily across all users. The process follows these steps:</p>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px; margin-bottom: 20px;\">\n","<li style=\"margin-bottom: 10px;\"><strong>1.</strong> A <strong>Pivot Table</strong> was created from the <code>hourly_master_table_Cleaned</code> to <strong>sum the total minutes asleep</strong> for each unique user ID.</li>\n","<br>\n","<li style=\"margin-bottom: 10px;\"><strong>2.</strong> These summed values were integrated into a <strong>Helper_Table</strong> and the new column <strong>Avg_MinutesAsleep</strong> was calculated using a <strong>VLOOKUP</strong> structure divided by <strong>[Days_Tracked]</strong>. This ensures the resulting average accurately reflects daily sleep over the entire tracking period.</li></ul>\n","<p style=\"font-size: 1.15em; text-align: justify; margin-top: 25px; margin-bottom: 20px;\">To enhance the segmentation power of the <strong>User Summary Table</strong>, the <strong>SleepQuality</strong> field was engineered based on the <strong>7-to-9-hour sleep recommendation</strong> (420–540 minutes), aligning the categories with public health guidelines:</p>\n","<ul style=\"font-size: 1.15em; text-align: justify; padding-left: 20px; margin-bottom: 20px;\">\n","<li style=\"margin-bottom: 10px;\"><strong>Low_Sleep:</strong> Avg_MinutesAsleep < 420 (Less than 7 hours, below the recommended threshold).</li>\n","<li style=\"margin-bottom: 10px;\"><strong>Optimal_Sleep:</strong> Avg_MinutesAsleep from 420 to 540 (The recommended 7 to 9 hours for recovery).</li>\n","<li style=\"margin-bottom: 10px;\"><strong>High_Sleep:</strong> Avg_MinutesAsleep > 540 (More than 9 hours, indicating an above-average priority for sleep).</li></ul>\n","<hr style=\"border: 0.5px solid #dcdcdc; margin-top: 30px; margin-bottom: 0px;\">"]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[],"dockerImageVersionId":30749,"isGpuEnabled":false,"isInternetEnabled":true,"language":"r","sourceType":"notebook"},"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"codemirror_mode":"r","file_extension":".r","mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"4.4.0"},"papermill":{"default_parameters":{},"duration":3.364077,"end_time":"2025-12-20T01:01:01.116575","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-12-20T01:00:57.752498","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}